{% extends 'config/base.html' %}
{% load widget_tweaks %}
{% load static %}
{% block content %}
<section class="row previewCart">
    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
        <div class="row totalItemsCart">
            <div class="col-xl-11 col-lg-11 col-md-11 col-sm-11 col-11 centerDiv prewviewCartContainer">
                <div class="row">
                    <div class="col-lx-12 col-lg-12 col-md-12 col-sm-12 col-12">
                        <h1>Mi Carrito</h1>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xl-9 col-lg-9 col-md-12 col-sm-12 col-12">
                        <div id="cont_ordenes"></div>
                        <!--
                        <div class="row itemCartContainer">
                            <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12 imageBuyCart">
                                <div class="row">
                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                        <img src="https://via.placeholder.com/950x680.png?">
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12 col-12 pricesDetailsContainer">
                                <div class="row editCartContains">
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3 offset-9">
                                        <p><a href=""><i class="fas fa-pencil-alt"></i></a> <a href="#"><i class="far fa-trash-alt"></i></a></p>
                                    </div>
                                </div>
                                <div class="row imagePriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4 class="imageName">Nombre de la Imagen:</h4>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                                        <h5 class="imagePrice">$ 129.99</h5>
                                    </div>
                                </div>
                                <div class="row framePriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4><i class="fas fa-plus"></i> Tipo de marco:</h4>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                                        <h5 class="framePrice">$ 179.99</h5>
                                    </div>
                                </div>
                                <div class="row marginPriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4><i class="fas fa-plus"></i> Tipo de Marialuisa:</h4>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                                        <h5 class="marginPrice">$ 39.99</h5>
                                    </div>
                                </div>
                                <div class="row shippingPriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4><i class="fas fa-plus"></i> Envío:</h4>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                                        <h5 class="shippingPrice">$ 99.99</h5>
                                    </div>
                                </div>
                                <div class="row totalPriceDetails">
                                    <div class="col-xl-6 col-lg-8 col-md-10 col-sm-12 col-12 offset-xl-6 offset-lg-4 offset-md-2">
                                        <h4>Subtotal: <span class="totalPrice">$ 449.96</span></h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row itemCartContainer">
                            <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12 imageBuyCart">
                                <div class="row">
                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                        <img src="https://via.placeholder.com/950x680.png?">
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12 col-12 pricesDetailsContainer">
                                <div class="row editCartContains">
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3 offset-9">
                                        <p><a href=""><i class="fas fa-pencil-alt"></i></a> <a href="#"><i class="far fa-trash-alt"></i></a></p>
                                    </div>
                                </div>
                                <div class="row imagePriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4 class="imageName">Nombre de la Imagen:</h4>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                                        <h5 class="imagePrice">$ 129.99</h5>
                                    </div>
                                </div>
                                <div class="row framePriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4><i class="fas fa-plus"></i> Digital:</h4>
                                    </div>
                                </div>
                                <div class="row totalPriceDetails">
                                    <div class="col-xl-6 col-lg-8 col-md-10 col-sm-12 col-12 offset-xl-6 offset-lg-4 offset-md-2">
                                        <h4>Subtotal: <span class="totalPrice">$ 129.99</span></h4>
                                    </div>
                                </div>
                                <div class="row totalPriceDetails">
                                    <div class="col-xl-6 col-lg-8 col-md-10 col-sm-12 col-12 offset-xl-6 offset-lg-4 offset-md-2">
                                        <a href="#" class="btn generalBtn"><i class="fas fa-plus"></i> Agrega un marco a tu foto</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        -->
                    </div>
                    <div class="col-xl-3 col-lg-3 col-md-12 col-sm-12 col-12">
                        <div class="row continueToPayment">
                            <div class="col-xl-11 col-lg-11 col-md-12 col-sm-12 col-12 centerDiv continuePaymentContent">
                                <div class="row">
                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                        <h4>Total: <span> ${{total}}</span></h4>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 paymentMethodTitle">
                                        <p>Elige un metodo de pago:</p>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 paymentMethods">
                                        <div class="row cc-selector">
                                            <div class="col-xl-12 col-lg-12 col-md-4 col-sm-4 col-4 paymentMethod">
                                                <input id="oxxoPayment" type="radio" name="paymentMethod" value="oxxoPayment" onclick="showOxxo()" />
                                                <label class="drinkcard-cc oxxo" for="oxxoPayment"></label>
                                            </div>
                                            <div class="col-xl-12 col-lg-12 col-md-4 col-sm-4 col-4 paymentMethod">
                                                <input id="cardPayment" type="radio" name="paymentMethod" value="cardPayment" onclick="showTarjeta()" />
                                                <label class="drinkcard-cc cardImage" for="cardPayment"></label>
                                            </div>
                                            <div class="col-xl-12 col-lg-12 col-md-4 col-sm-4 col-4 paymentMethod">
                                                <input id="speiPayment" type="radio" name="paymentMethod" value="speiPayment" onclick="showSpei()" />
                                                <label class="drinkcard-cc spei" for="speiPayment"></label>
                                            </div>
                                        </div>
                                        <!--De acuerdo con la seleccion de usuario, se muestra la opción de pago-->
                                        <div id="oxxoForm" class="row oxxoPaymentSelected" style="display: none">
                                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                <div class="row">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <p>Pago en OXXO:</p>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <select class="form-control" id="direccion_oxxo">
                                                            <option selected disabled>Elige una Direccion:</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <a href="{% url 'webapp:nuevo_direccion' %}" class="btn generalBtn"><i class="fas fa-plus"></i> Agregar dirección</a>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <input type="text" placeholder="Codigo de Promoción" class="form-control">
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <a href="#" class="btn generalBtn">Aplicar código</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="tarjetaForm" class="row cardPaymentSelected" style="display: none">
                                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                <div class="row">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <p>Pago con Tarjeta:</p>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <select class="form-control" id="tarjeta">
                                                            <option selected disabled>Elige una tarjeta:</option>
                                                        
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <a href="{% url 'webapp:nuevo_tarjeta' %}" class="btn generalBtn"><i class="fas fa-plus"></i> Agregar tarjeta</a>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <select class="form-control" id="direccion_tarjeta">
                                                            <option selected disabled>Elige una Direccion:</option>
                                                            
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <a href="{% url 'webapp:nuevo_direccion' %}" class="btn generalBtn"><i class="fas fa-plus"></i> Agregar dirección</a>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <input type="text" placeholder="Codigo de Promoción" class="form-control">
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <a href="#" class="btn generalBtn">Aplicar código</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="speiForm" class="row speiPaymentSelected" style="display: none">
                                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                <div class="row">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <p>Pago por SPEI:</p>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <select class="form-control" id="direccion_spei">
                                                            <option selected disabled>Elige una Direccion:</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <a href="{% url 'webapp:nuevo_direccion' %}" class="btn generalBtn"><i class="fas fa-plus"></i> Agregar dirección</a>
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <input type="text" placeholder="Codigo de Promoción" class="form-control">
                                                    </div>
                                                </div>
                                                <div class="row form-group">
                                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                        <a href="#" class="btn generalBtn">Aplicar código</a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!--De acuerdo con la seleccion de usuario, se muestra la opción de pago-->
                                        <div class="row">
                                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                                <button style="cursor: pointer" onclick="pagarOrden(2)" class="btn generalBtn specialBtn">Realizar Pago</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script src="{% static 'js/crsfajax.js' %}"></script>
<script>
    $('document').ready(function() {
        $.ajax({
            url: "/ws/listar_carrito/",
            type: "GET",
            cache: false,
            success: function(json) {
                console.log(json);
                for (let i of json) {
                    var text = `
                    <div id="orden` + i.pk + `">
                        <div class="row itemCartContainer">
                            <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12 col-12 imageBuyCart">
                                <div class="row">
                                    <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12">
                                        <img src="` + i.foto.foto_muestra + `">
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12 col-12 pricesDetailsContainer">
                                <div class="row editCartContains">
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3 offset-9">
                                        <p>`

                    if (i.tipo_compra != 1) {
                        text += `<button onclick="editarOrden(` + i.pk + `)"><i class="fas fa-pencil-alt"></i></button>`
                    }

                    text += `<button onclick="eliminarOrden(` + i.pk + `)"><i class="far fa-trash-alt"></i></button></p>
                                    </div>
                                </div>
                                <div class="row imagePriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4 class="imageName">Nombre de la Imagen: </h4>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                                        <h5 class="imagePrice">` + i.foto.nombre + `</h5>
                                    </div>
                                </div>
                                `

                    if (i.marco) {
                        text += `
                                <div class="row framePriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4><i class="fas fa-plus"></i> Tipo de marco: ` + i.marco.nombre + `</h4>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                                        <h5 class="framePrice">` + i.marco.precio + `</h5>
                                    </div>
                                </div>
                                <div class="row marginPriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4><i class="fas fa-plus"></i> Tipo de Marialuisa: `+ i.maria_luisa.nombre +`</h4>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                                        <h5 class="marginPrice">` + i.maria_luisa.precio + `</h5>
                                    </div>
                                </div>
                                <div class="row marginPriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4><i class="fas fa-plus"></i> Tipo de papel: `+ i.papel_impresion.tipo_papel.nombre +`</h4>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                                        <h5 class="marginPrice">` + i.papel_impresion.precio + `</h5>
                                    </div>
                                </div>
                                <div class="row shippingPriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4><i class="fas fa-plus"></i> Envío:</h4>
                                    </div>
                                    <div class="col-xl-3 col-lg-3 col-md-3 col-sm-3 col-3">
                                        <h5 class="shippingPrice">$ 99.99</h5>
                                    </div>
                                </div>
                             `
                    } else {
                        text += `
                                <div class="row framePriceDetails">
                                    <div class="col-xl-9 col-lg-9 col-md-9 col-sm-9 col-9">
                                        <h4><i class="fas fa-plus"></i> Digital:</h4>
                                    </div>
                                </div>`
                    }
                    text += `
                                    <div class="row totalPriceDetails">
                                        <div class="col-xl-6 col-lg-8 col-md-10 col-sm-12 col-12 offset-xl-6 offset-lg-4 offset-md-2">
                                            <h4>Subtotal: <span class="totalPrice">$` + i.subtotal + `</span></h4>`

                    if (i.tipo_compra == 1) {

                        text += `<button type="button" class="btn btn-warning" onclick="agregarMarco(` + i.pk + `)">+ Agrega un marco a tu foto</button>`
                    }
                    text += `</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `
                    $('#cont_ordenes').append(text)
                }

            }
        })

        $.ajax({
            url: "/ws/list_tarjetas/",
            type: "GET",
            cache: false,
            success: function(json) {
                console.log('tarj', json);
                for (i in json) {
                    $('#tarjeta').append(
                        $("<option></option>")
                        .attr("value", json[i].pk)
                        .text("**** **** **** " + json[i].ultimos_digitos)
                    );
                }
            }
        })
        

        $.ajax({
            url: "/ws/list_direcciones/",
            type: "GET",
            cache: false,
            success: function(json) {
                console.log('direcciones',json)
                for (i in json) {
                    $('#direccion_tarjeta').append(
                        $("<option></option>")
                        .attr("value", json[i].pk)
                        .text(json[i].nombre + ', ' + json[i].calle, ', ' + json[i].num_exterior)
                    );
                }
            }
        })

    });


{#    switch (expr) {#}
{#  case 'Naranja':#}
{#    console.log('El kilogramo de Naranjas cuesta $0.59.');#}
{#    break;#}
{#  case 'Manzana':#}
{#    console.log('El kilogramo de Manzanas cuesta $0.32.');#}
{#    break;#}
{#  case 'Banana':#}
{#    console.log('El kilogramo de Bananas cuesta $0.48.');#}
{#    break;#}
{#  case 'Cereza':#}
{#    console.log('El kilogramo de Cerezas cuesta $3.00.');#}
{#    break;#}
{#  case 'Mango':#}
{#  case 'Papaya':#}
{#    console.log('El kilogramo de Mangos y Papayas cuesta $2.79.');#}
{#    break;#}
{#  default:#}
{#    console.log('Lo lamentamos, por el momento no disponemos de ' + expr + '.');#}

    // tarjeta es 2
    // oxxo 3
    // spei 4
    function pagarOrden(tipo) {
        let datosPago = {
            metodo_pago : tipo,
            direccion: $('#direccion_tarjeta').val(),
            tarjeta: $('#tarjeta').val(),
        }
        $.ajax({
             url: "/ws/pagar_orden/",
             type: "POST",
             cache: false,
             data: datosPago,
             success: function (res) {
                 console.log(res)
                 alert('Pago realizado con exito')
                 window.location.href = "{% url 'webapp:vista_carrito' %}"
             },
             error: (err) => {console.log(err)}
         })
    }


    function editarOrden(id) {
        console.log(id)
        /* $.ajax({
             url: "/ws/agregar_carrito/",
             type: "POST",
             cache: false,
             data: data,
             success: function (res) {
                 console.log(res)
                 window.location.href = "{% url 'webapp:vista_carrito' %}"
             },
             error: (err) => {console.log(err)}
         }) */
    }

    function eliminarOrden(id) {
        $.ajax({
            url: "/ws/eliminar_producto_carrito/",
            type: "POST",
            cache: false,
            data: {
                pk: id
            },
            success: function(res) {
                console.log(res)
                window.location.href = "{% url 'webapp:vista_carrito' %}"
            },
            error: (err) => {
                console.log(err)
            }
        })
    }

    function agregarMarco(id) {
        window.location.href = "/webapp/marco/" + id;
    }


    function showOxxo() {
        $('#oxxoForm').show();
        $('#tarjetaForm').hide();
        $('#speiForm').hide();
    }

    function showTarjeta() {
        $('#tarjetaForm').show()
        $('#oxxoForm').hide();
        $('#speiForm').hide();
    }

    function showSpei() {
        $('#speiForm').show();
        $('#tarjetaForm').hide();
        $('#oxxoForm').hide();
    }

</script>
{% endblock %}
